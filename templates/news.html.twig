{% extends 'base.html.twig' %}

{% block body %}

<div class="flex h-screen w-full">
    {% include 'components/sidebar.html.twig' %}

    <div class="w-full h-full overflow-y-auto">
        <div class="bg-gray-900 min-h-screen text-white p-6 relative">
            <div class="max-w-3xl mx-auto">
                {# √î ƒëƒÉng tr·∫°ng th√°i #}
                <div class="bg-gray-800 p-4 rounded-lg shadow-md mb-4">
                    <div class="flex items-center space-x-3">
                        <a href="/dashboard/profile/{{ profile.slug }}">
                            <img src="{{ profile.avatar }}" class="w-10 h-10 rounded-full border border-gray-700">
                        </a>
                        <input type="text" placeholder="{{ profile.name }} ∆°i, b·∫°n ƒëang nghƒ© g√¨ th·∫ø?"
                               class="flex-1 bg-gray-700 text-white p-2 rounded-full outline-none placeholder-gray-400 cursor-pointer"
                               id="openModal">
                    </div>
                </div>

                <div id="postModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-[99999]">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-96 relative z-[99999]">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-white text-lg font-semibold">T·∫°o b√†i vi·∫øt</h2>
                            <button id="closeModal" class="text-gray-400 hover:text-white text-xl">‚úñ</button>
                        </div>

                        <!-- Form ƒëƒÉng b√†i -->
                        <form action="{{ path('create_post') }}" method="POST">
            <textarea name="content" id="postContent" class="w-full h-32 p-2 rounded-lg bg-gray-700 text-white"
                      placeholder="B·∫°n ƒëang nghƒ© g√¨?"></textarea>

                            <!-- N√∫t ƒëƒÉng b√†i -->
                            <div class="flex justify-end mt-4">
                                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                                    ƒêƒÉng b√†i
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                {# Danh s√°ch b·∫°n b√® #}
                <div class="relative w-full max-w-2xl mx-auto mt-10">
                    <!-- Swiper Container -->
                    <div class="swiper mySwiper">
                        <div class="swiper-wrapper">
                            {# Danh s√°ch b·∫°n b√® #}
                            {% for friend in friendList %}
                                <a href="/dashboard/profile/{{ friend.slug }}" class="swiper-slide relative w-32 h-48 bg-gray-800 rounded-xl overflow-hidden shrink-0">
                                    <img src="{{ friend.avatar }}" class="w-full h-full object-cover">
                                    {# Avatar b·∫°n b√® #}
                                    <div class="absolute top-2 left-2 w-10 h-10 border-4 border-gray-900 rounded-full overflow-hidden">
                                        <img src="{{ friend.avatar }}" class="w-full h-full object-cover">
                                    </div>
                                    {# T√™n b·∫°n b√® #}
                                    <div class="absolute bottom-2 left-2 text-sm font-semibold truncate w-full text-center px-2">
                                        {{ friend.name }}
                                    </div>
                                </a>
                            {% endfor %}
                        </div>

                        <!-- N√∫t b·∫•m tr√°i/ph·∫£i -->
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-button-next"></div>
                    </div>
                </div>

            </div>
            {# Danh s√°ch b√†i vi·∫øt #}
            <div class="bg-gray-900 min-h-screen text-white p-6 h-full">
                <div class="max-w-2xl mx-auto">
                    {% for post in posts %}
                        <div class="bg-gray-800 p-4 rounded-lg shadow-lg mb-6">
                            {# Header b√†i ƒëƒÉng #}
                            <div class="flex items-center space-x-3">
                                <img src="{{ post.avatarAuthor }}" class="w-10 h-10 rounded-full" alt="Avatar c·ªßa {{ post.authorName }}">
                                <div>
                                    <p class="font-semibold">{{ post.authorName }}</p>
                                    <p class="text-sm text-gray-400">{{ post.createdAt|date('d/m/Y H:i') }} ‚Ä¢ üåç</p>
                                </div>
                            </div>

                            {# N·ªôi dung b√†i ƒëƒÉng #}
                            <div class="mt-3 text-gray-300">
                                <p>{{ post.content|raw }}</p>
                            </div>

                            {# L∆∞·ª£t th√≠ch, b√¨nh lu·∫≠n, chia s·∫ª #}
                            <div class="flex justify-between items-center mt-3 text-gray-400 text-sm">
                                <div class="flex items-center space-x-2">
                                    <span>üëç</span>
                                    <span>{{ post.likes }} l∆∞·ª£t th√≠ch</span>
                                </div>
                            </div>

                            {# N√∫t t∆∞∆°ng t√°c #}
                            <div class="flex justify-between mt-2 border-t border-gray-600 pt-2">
                                <button class="flex-1 flex items-center justify-center py-2 rounded-lg hover:bg-gray-700 transition">
                                    üëç Th√≠ch
                                </button>
                                <button class="flex-1 flex items-center justify-center py-2 rounded-lg hover:bg-gray-700 transition">
                                    üí¨ B√¨nh lu·∫≠n
                                </button>
                                <button class="flex-1 flex items-center justify-center py-2 rounded-lg hover:bg-gray-700 transition">
                                    üîÑ Chia s·∫ª
                                </button>
                            </div>
                        </div>
                    {% else %}
                        <p class="text-center text-gray-400">Kh√¥ng c√≥ b√†i vi·∫øt n√†o.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        </div>

    <!-- Script TinyMCE v√† Modal -->
    <script src="https://cdn.tiny.cloud/1/4ap6sni821pn56o84cses0860nmtuvurlwoxovop0j9t37j5/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
    <!-- Nh√∫ng Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

    <!-- Nh√∫ng Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Swiper Init -->
    <script>
        var swiper = new Swiper(".mySwiper", {
            slidesPerView: 4,   // Hi·ªÉn th·ªã 4 √¥ b·∫°n b√® m·ªói l·∫ßn
            spaceBetween: 15,   // Kho·∫£ng c√°ch gi·ªØa c√°c √¥
            navigation: {       // N√∫t ƒëi·ªÅu h∆∞·ªõng
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            grabCursor: true,   // Hi·ªáu ·ª©ng b√†n tay khi r√™ chu·ªôt
            loop: false,        // Kh√¥ng l·∫∑p v√¥ h·∫°n
        });
    </script>

{#    Tiny MCE#}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Kh·ªüi t·∫°o TinyMCE
            tinymce.init({
                selector: '#postContent',
                menubar: false,
                plugins: 'autolink lists link image charmap preview',
                toolbar: 'undo redo | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent',
                skin: "oxide-dark",
                content_css: "dark",
                setup: function (editor) {
                    editor.on('focus', function () {
                        document.getElementById("postModal").classList.add("z-[9999]");
                    });
                }
            });

            // Modal
            const modal = document.getElementById("postModal");
            const openModal = document.getElementById("openModal");
            const closeModal = document.getElementById("closeModal");

            openModal.addEventListener("click", function () {
                modal.classList.remove("hidden");
            });

            closeModal.addEventListener("click", function () {
                modal.classList.add("hidden");
            });

            // ƒê√≥ng modal khi click ra ngo√†i
            modal.addEventListener("click", function (e) {
                if (e.target === modal) {
                    modal.classList.add("hidden");
                }
            });
        });
    </script>

{#    Modal Open/Close#}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const modal = document.getElementById("postModal");
            const openModal = document.getElementById("openModal");
            const closeModal = document.getElementById("closeModal");

            openModal.addEventListener("click", function () {
                modal.classList.remove("hidden");
            });

            closeModal.addEventListener("click", function () {
                modal.classList.add("hidden");
            });

            // ƒê√≥ng modal khi click ra ngo√†i
            modal.addEventListener("click", function (e) {
                if (e.target === modal) {
                    modal.classList.add("hidden");
                }
            });
        });
    </script>

{% endblock %}
