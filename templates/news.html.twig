{% extends 'base.html.twig' %}

{% block title %}Tin t·ª©c{% endblock %}

{% block body %}

<div class="flex h-screen w-full">
    {% include 'components/sidebar.html.twig' %}

    <style>
        html, body {
            scroll-behavior: smooth;
        }

        /* Left Part Container */
        .left-part {
            width: 100%;
            max-width: 70%; /* ƒê·ªëi v·ªõi m√†n h√¨nh l·ªõn */
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* ·∫¢nh b√†i vi·∫øt */
        .left-part .article-content img {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 8px; /* Bo g√≥c m·ªÅm m·∫°i */
            margin-bottom: 1rem;
        }

        /* Title Section */
        .left-part .title-section {
            font-size: 2rem; /* Ti√™u ƒë·ªÅ l·ªõn */
            line-height: 1.3;
            color: #1f2937; /* M√†u ƒëen ƒë·∫≠m */
            margin-bottom: -30px;
        }

        /* Description */
        .left-part .body-medium {
            font-size: 1rem; /* C·ª° ch·ªØ c∆° b·∫£n */
            line-height: 1.6;
            color: #374151; /* M√†u x√°m ƒë·∫≠m */
        }

        .left-part .title-small {
            font-size: 1.25rem; /* Ti√™u ƒë·ªÅ nh·ªè */
            line-height: 1.5;
            font-weight: bold;
        }

        /* Article Content */
        .left-part .article-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #333;
        }

        .left-part .article-content h1,
        .left-part .article-content h2,
        .left-part .article-content h3,
        .left-part .article-content h4 {
            font-weight: bold;
            margin: 1rem 0;
            font-size: 28px;
        }

        .left-part .article-content p {
            margin-bottom: 1.5rem;
        }

        .left-part .article-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        figure.wp-caption.aligncenter {
            width: auto !important; /* Lo·∫°i b·ªè chi·ªÅu r·ªông c·ªë ƒë·ªãnh */
            max-width: 100%; /* ƒê·∫£m b·∫£o kh√¥ng v∆∞·ª£t qu√° k√≠ch th∆∞·ªõc m√†n h√¨nh */
        }

        table {
            display: block; /* Bi·∫øn b·∫£ng th√†nh kh·ªëi ƒë·ªÉ th√™m cu·ªôn */
            overflow-x: auto; /* Th√™m thanh cu·ªôn ngang */
            white-space: nowrap; /* NgƒÉn ng·∫Øt d√≤ng n·ªôi dung b·∫£ng */
        }

        table th,
        table td {
            border: 1px solid #ddd; /* ƒê∆∞·ªùng vi·ªÅn gi·ªØa c√°c √¥ */
            padding: 15px; /* Kho·∫£ng c√°ch trong √¥ */
            text-align: left; /* CƒÉn ch·ªØ sang tr√°i */
        }

        table::before {
            content: ''; /* T·∫°o ph·∫ßn t·ª≠ gi·∫£ */
            display: block;
            height: 0; /* ƒê·∫£m b·∫£o kh√¥ng ·∫£nh h∆∞·ªüng layout */
        }

        tr:hover {
            background-color: #f1f1f1; /* ƒê·ªïi m√†u h√†ng khi hover */
        }

        tr:nth-child(even) {
            background-color: #f9f9f9; /* M√†u n·ªÅn xen k·∫Ω */
        }

        td {
            transition: background-color 0.3s; /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m√†u khi hover */
        }
        #editModal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            max-width: 90%;
            background: #1f2937;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            display: none; /* ƒê·∫£m b·∫£o ban ƒë·∫ßu modal b·ªã ·∫©n */
            z-index: 99999;
        }

        #commentModal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-width: 90%;
            background: #18191A;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            display: none; /* ·∫®n modal ban ƒë·∫ßu */
            z-index: 99999;
        }

        #commentList {
            max-height: 300px;
            overflow-y: auto;
        }

        #commentInput {
            width: 100%;
            border: none;
            background: #3A3B3C;
            padding: 10px;
            border-radius: 20px;
        }

        #sendComment {
            background: #2374E1;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }

        #comments {
            display: flex;
            flex-direction: column; /* B√¨nh lu·∫≠n x·∫øp d·ªçc */
            gap: 8px; /* Kho·∫£ng c√°ch gi·ªØa c√°c b√¨nh lu·∫≠n */
        }

        .comment-item {
            display: flex;
            align-items: flex-start;
            background-color: #242526; /* M√†u n·ªÅn t·ªëi h∆°n */
            padding: 12px;
            border-radius: 12px;
            max-width: 100%;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .comment-item img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-right: 10px;
            border: 1px solid #3A3B3C;
        }

        .comment-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
            color: #B0B3B8;
        }

        .comment-header span {
            font-weight: bold;
            color: white;
        }

        .comment-text {
            font-size: 14px;
            margin-top: 5px;
            color: #E4E6EB;
        }

        .comment-footer {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #B0B3B8;
            margin-top: 5px;
        }

        .comment-footer button {
            background: none;
            border: none;
            color: #B0B3B8;
            cursor: pointer;
            font-size: 12px;
            margin-right: 15px;
        }

        .comment-footer button:hover {
            color: #E4E6EB;
        }

        .comment-footer i {
            margin-right: 4px;
        }

        .comment-footer .likes {
            display: flex;
            align-items: center;
            font-size: 12px;
        }

        .comment-footer {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #B0B3B8;
            margin-top: 5px;
            justify-content: flex-start; /* Canh v·ªÅ b√™n tr√°i */
            gap: 10px; /* Kho·∫£ng c√°ch gi·ªØa c√°c ph·∫ßn t·ª≠ */
        }

        .comment-footer .likes {
            display: flex;
            align-items: center;
            font-size: 12px;
            gap: 5px; /* Kho·∫£ng c√°ch gi·ªØa icon v√† s·ªë */
        }

        .comment-footer .comment-time {
            color: gray;
            font-size: 12px;
            margin-left: auto; /* ƒê·∫©y th·ªùi gian v·ªÅ b√™n ph·∫£i */
        }

        .commentPage{
            max-height: 500px;
        }

        /* ƒê·∫£m b·∫£o n·ªôi dung kh√¥ng v∆∞·ª£t qu√° chi·ªÅu cao 500px */
        .content-truncate {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        /* N√∫t Xem th√™m v√† Thu g·ªçn */
        .btn-toggle {
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            margin-top: 10px;
        }

    </style>

    <div class="w-full h-full overflow-y-auto">
        <div class="bg-gray-900 min-h-screen text-white p-6 relative">
            <div class="max-w-3xl mx-auto">
                {# √î ƒëƒÉng tr·∫°ng th√°i #}
                <div class="bg-gray-800 p-4 rounded-lg shadow-md mb-4">
                    <div class="flex items-center space-x-3">
                        <a href="/dashboard/profile/{{ profile.slug }}">
                            <img src="{{ profile.avatar }}" class="w-10 h-10 rounded-full border border-gray-700">
                        </a>
                        <div type="text" placeholder=""
                               class="flex-1 bg-gray-700 text-white p-2 rounded-full outline-none placeholder-gray-400 cursor-pointer"
                             id="openModal">{{ profile.name }} ∆°i, b·∫°n ƒëang nghƒ© g√¨ th·∫ø? </div>
                    </div>
                </div>

                <div id="postModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-[99999]">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-96 relative z-[99999]">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-white text-lg font-semibold">T·∫°o b√†i vi·∫øt</h2>
                            <button id="closeModal" class="text-gray-400 hover:text-white text-xl">‚úñ</button>
                        </div>

                        <!-- Form ƒëƒÉng b√†i -->
                        <form action="{{ path('create_post') }}" method="POST">
            <textarea name="content" id="postContent" class="w-full h-32 p-2 rounded-lg bg-gray-700 text-white"
                      placeholder="B·∫°n ƒëang nghƒ© g√¨?"></textarea>

                            <!-- N√∫t ƒëƒÉng b√†i -->
                            <div class="flex justify-end mt-4">
                                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                                    ƒêƒÉng b√†i
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                {# Danh s√°ch b·∫°n b√® #}
                <div class="relative w-full max-w-2xl mx-auto mt-10">
                    <!-- Swiper Container -->
                    <div class="swiper mySwiper">
                        <div class="swiper-wrapper">
                            {# Danh s√°ch b·∫°n b√® #}
                            {% for friend in friendList %}
                                <a href="/dashboard/profile/{{ friend.slug }}" class="swiper-slide relative w-32 h-48 bg-gray-800 rounded-xl overflow-hidden shrink-0">
                                    <img src="{{ friend.avatar }}" class="w-full h-full object-cover">
                                    {# Avatar b·∫°n b√® #}
                                    <div class="absolute top-2 left-2 w-10 h-10 border-4 border-gray-900 rounded-full overflow-hidden">
                                        <img src="{{ friend.avatar }}" class="w-full h-full object-cover">
                                    </div>
                                    {# T√™n b·∫°n b√® #}
                                    <div class="absolute bottom-2 left-2 text-sm font-semibold truncate w-full text-center px-2">
                                        {{ friend.name }}
                                    </div>
                                </a>
                            {% endfor %}
                        </div>

                        <!-- N√∫t b·∫•m tr√°i/ph·∫£i -->
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-button-next"></div>
                    </div>
                </div>

                {# Modal edit b√†i vi·∫øt #}
                <!-- Modal ch·ªânh s·ª≠a b√†i vi·∫øt -->
                <div id="editModal">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg relative">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-white text-lg font-semibold">Ch·ªânh s·ª≠a b√†i vi·∫øt</h2>
                            <button id="closeEditModal" class="text-gray-400 hover:text-white text-xl">‚úñ</button>
                        </div>

                        <!-- Form ch·ªânh s·ª≠a -->
                        <form id="editForm" method="POST">
                            <textarea name="content" id="editContent" class="w-full h-32 p-2 rounded-lg bg-gray-700 text-white"></textarea>

                            <!-- N√∫t c·∫≠p nh·∫≠t -->
                            <div class="flex justify-end mt-4">
                                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                                    C·∫≠p nh·∫≠t b√†i vi·∫øt
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
            {# Danh s√°ch b√†i vi·∫øt #}
            <div class="bg-gray-900 min-h-screen text-white p-6 h-full">
                <div class="max-w-2xl mx-auto">
                    {% for post in posts %}
                        <div class="bg-gray-800 p-4 rounded-lg shadow-lg mb-6">
                            {# Header b√†i ƒëƒÉng #}
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <img src="{{ post.avatarAuthor }}" class="w-10 h-10 rounded-full" alt="Avatar c·ªßa {{ post.authorName }}">
                                    <div>
                                        <p class="font-semibold">{{ post.authorName }}</p>
                                        <p class="text-sm text-gray-400">{{ post.createdAt|date('d/m/Y H:i') }} ‚Ä¢ üåç</p>
                                    </div>
                                </div>

                                {# N√∫t ch·ªânh s·ª≠a & x√≥a (Ch·ªâ hi·ªÉn th·ªã n·∫øu l√† t√°c gi·∫£) #}
                                {% if post.idAuthor == profile.userId %}
                                    <div class="flex space-x-2">
                                        <button class="text-blue-400 hover:text-blue-300 transition" onclick="editPost({{ post.id }})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-400 hover:text-red-300 transition" onclick="deletePost({{ post.id }})">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                {% endif %}
                            </div>

                            {# N·ªôi dung b√†i ƒëƒÉng #}
                            <div class="mt-3 text-gray-300">
                                <div id="post-content-{{ post.id }}" class="content-truncate" style="max-height: 500px; overflow: hidden;">
                                    {{ post.content|raw }}
                                </div>
                                <button id="toggle-btn-{{ post.id }}" class="btn-toggle">Xem th√™m</button>
                            </div>

                            {# L∆∞·ª£t th√≠ch, b√¨nh lu·∫≠n #}
                            <div class="flex justify-between items-center mt-3 text-gray-400 text-sm">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span id="like-display-{{ post.id }}" class="mr-3">{{ post.likes }} l∆∞·ª£t th√≠ch</span>
                                </div>
                            </div>

                            {# N√∫t t∆∞∆°ng t√°c #}
                            <div class="flex justify-between mt-2 border-t border-gray-600 pt-2">
                                <button id="like-button-{{ post.id }}"
                                        class="flex-1 flex items-center justify-center py-2 rounded-lg transition
                               {% if post.userLiked %} bg-blue-500 text-white {% else %} hover:bg-gray-700 {% endif %}"
                                                        onclick="toggleLike({{ post.id }})">
                                                    <i class="fas fa-thumbs-up mr-3"></i>
                                                    <span id="like-label-{{ post.id }}">
                                        {% if post.userLiked %} ƒê√£ th√≠ch {% else %} Th√≠ch {% endif %}
                                   </span>
                                </button>

                                <button class="flex-1 flex items-center justify-center py-2 rounded-lg hover:bg-gray-700 transition"
                                        onclick="toggleComments({{ post.id }})">
                                    <i class="fas fa-comment-alt mr-3"></i> B√¨nh lu·∫≠n
                                    <span id="comment-count-{{ post.id }}" class="ml-2 text-sm">({{ post.commentCount }})</span>
                                </button>
                            </div>

                            <!-- Khu v·ª±c hi·ªÉn th·ªã b√¨nh lu·∫≠n -->
                            <div id="comment-section-{{ post.id }}" class="hidden mt-4">
                                <div id="comments-{{ post.id }}" class="commentPage text-gray-300 p-3 max-h-60 overflow-y-auto"></div>

                                <div class="flex items-center bg-gray-800 p-3 rounded-lg mt-3">
                                    <img src="{{ profile.avatar }}" class="w-10 h-10 rounded-full border border-gray-700">
                                    <input type="text" id="comment-input-{{ post.id }}" class="flex-1 ml-3 bg-gray-700 text-white p-2 rounded-full outline-none" placeholder="Vi·∫øt b√¨nh lu·∫≠n...">
                                    <button class="ml-3 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg" onclick="sendComment({{ post.id }})">G·ª≠i</button>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <p class="text-center text-gray-400">Kh√¥ng c√≥ b√†i vi·∫øt n√†o.</p>
                    {% endfor %}
                </div>
            </div>

        </div>
    </div>
</div>


    <!-- Script TinyMCE v√† Modal -->
    <script src="https://cdn.tiny.cloud/1/4ap6sni821pn56o84cses0860nmtuvurlwoxovop0j9t37j5/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
    <!-- Nh√∫ng Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

    <!-- Nh√∫ng Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    {#Swiper Init#}
    <script>
        var swiper = new Swiper(".mySwiper", {
            slidesPerView: 4,   // Hi·ªÉn th·ªã 4 √¥ b·∫°n b√® m·ªói l·∫ßn
            spaceBetween: 15,   // Kho·∫£ng c√°ch gi·ªØa c√°c √¥
            navigation: {       // N√∫t ƒëi·ªÅu h∆∞·ªõng
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            grabCursor: true,   // Hi·ªáu ·ª©ng b√†n tay khi r√™ chu·ªôt
            loop: false,        // Kh√¥ng l·∫∑p v√¥ h·∫°n
        });
    </script>

    {#Tiny MCE#}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Kh·ªüi t·∫°o TinyMCE
            tinymce.init({
                selector: '#postContent',
                menubar: false,
                plugins: 'autolink lists link image charmap preview',
                toolbar: 'undo redo | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent',
                skin: "oxide-dark",
                content_css: "dark",
                setup: function (editor) {
                    editor.on('focus', function () {
                        document.getElementById("postModal").classList.add("z-[9999]");
                    });
                }
            });

            // Modal
            const modal = document.getElementById("postModal");
            const openModal = document.getElementById("openModal");
            const closeModal = document.getElementById("closeModal");

            openModal.addEventListener("click", function () {
                modal.classList.remove("hidden");
            });

            closeModal.addEventListener("click", function () {
                modal.classList.add("hidden");
            });

            // ƒê√≥ng modal khi click ra ngo√†i
            modal.addEventListener("click", function (e) {
                if (e.target === modal) {
                    modal.classList.add("hidden");
                }
            });
        });
    </script>

    {#Modal Open/Close#}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const modal = document.getElementById("postModal");
            const openModal = document.getElementById("openModal");
            const closeModal = document.getElementById("closeModal");

            openModal.addEventListener("click", function () {
                modal.classList.remove("hidden");
            });

            closeModal.addEventListener("click", function () {
                modal.classList.add("hidden");
            });

            // ƒê√≥ng modal khi click ra ngo√†i
            modal.addEventListener("click", function (e) {
                if (e.target === modal) {
                    modal.classList.add("hidden");
                }
            });
        });
    </script>

    {#Edit Modal#}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const editModal = document.getElementById("editModal");
            const closeEditModal = document.getElementById("closeEditModal");
            const editForm = document.getElementById("editForm");
            let currentPostId = null;

            // H√†m kh·ªüi t·∫°o TinyMCE n·∫øu ch∆∞a c√≥
            function initTinyMCE(callback) {
                if (!tinymce.get('editContent')) {
                    tinymce.init({
                        selector: '#editContent',
                        menubar: false,
                        plugins: 'autolink lists link image charmap preview',
                        toolbar: 'undo redo | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent',
                        skin: "oxide-dark",
                        content_css: "dark",
                        setup: function (editor) {
                            editor.on('init', function () {
                                console.log("TinyMCE ƒë√£ kh·ªüi t·∫°o");
                                if (callback) callback();
                            });
                        }
                    });
                } else {
                    if (callback) callback();
                }
            }

            // M·ªü modal ch·ªânh s·ª≠a
            function openEditModal(postId, currentContent) {
                currentPostId = postId;

                // ƒê·∫£m b·∫£o TinyMCE ƒë√£ kh·ªüi t·∫°o tr∆∞·ªõc khi set n·ªôi dung
                initTinyMCE(() => {
                    tinymce.get('editContent').setContent(currentContent);
                });

                // Hi·ªÉn th·ªã modal ·ªü ch√≠nh gi·ªØa m√†n h√¨nh
                editModal.style.display = "block";
            }

            // ƒê√≥ng modal ch·ªânh s·ª≠a
            closeEditModal.addEventListener("click", function () {
                editModal.style.display = "none";
            });

            // G·ª≠i request c·∫≠p nh·∫≠t b√†i vi·∫øt b·∫±ng AJAX
            editForm.addEventListener("submit", function (e) {
                e.preventDefault(); // NgƒÉn ch·∫∑n load l·∫°i trang

                const newContent = tinymce.get('editContent').getContent(); // L·∫•y n·ªôi dung t·ª´ TinyMCE

                fetch(`/post/edit/${currentPostId}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ content: newContent }),
                })
                    .then(response => response.json())
                    .then(data => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Th√†nh c√¥ng!',
                            text: data.message,
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            editModal.style.display = "none"; // ·∫®n modal sau khi ch·ªânh s·ª≠a
                            window.location.href = "/dashboard/news"; // Quay l·∫°i trang tin t·ª©c
                        });
                    })
                    .catch(error => {
                        Swal.fire({
                            icon: 'error',
                            title: 'L·ªói!',
                            text: "C√≥ l·ªói x·∫£y ra khi ch·ªânh s·ª≠a b√†i vi·∫øt.",
                            showConfirmButton: true
                        });
                        console.error("L·ªói:", error);
                    });
            });

            // H√†m m·ªü modal ch·ªânh s·ª≠a t·ª´ n√∫t "Ch·ªânh s·ª≠a"
            window.editPost = function (postId) {
                fetch(`/post/${postId}`)
                    .then(response => response.json())
                    .then(data => {
                        openEditModal(postId, data.content);
                    })
                    .catch(error => console.error("L·ªói khi l·∫•y n·ªôi dung b√†i vi·∫øt:", error));
            };
        });

        function deletePost(postId) {
            Swal.fire({
                title: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i vi·∫øt?",
                text: "H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "X√≥a",
                cancelButtonText: "H·ªßy"
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/post/delete/${postId}`, {
                        method: "DELETE",
                    })
                        .then(response => response.json())
                        .then(data => {
                            Swal.fire({
                                icon: 'success',
                                title: 'Th√†nh c√¥ng!',
                                text: data.message,
                                timer: 2000,
                                showConfirmButton: false
                            }).then(() => {
                                location.reload(); // L√†m m·ªõi trang sau khi x√≥a
                            });
                        })
                        .catch(error => {
                            Swal.fire({
                                icon: 'error',
                                title: 'L·ªói!',
                                text: "C√≥ l·ªói x·∫£y ra khi x√≥a b√†i vi·∫øt.",
                                showConfirmButton: true
                            });
                            console.error("L·ªói:", error);
                        });
                }
            });
        }
    </script>

    {#Toggle Like#}
    <script>
        function toggleLike(postId) {
            fetch(`/post/like/${postId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert(data.message);
                        return;
                    }

                    // L·∫•y c√°c ph·∫ßn t·ª≠ HTML c·∫ßn c·∫≠p nh·∫≠t
                    const likeButton = document.getElementById(`like-button-${postId}`);
                    const likeLabel = document.getElementById(`like-label-${postId}`);
                    const likeDisplay = document.getElementById(`like-display-${postId}`);

                    // Ki·ªÉm tra n·∫øu c√°c ph·∫ßn t·ª≠ t·ªìn t·∫°i tr∆∞·ªõc khi c·∫≠p nh·∫≠t
                    if (likeDisplay) {
                        likeDisplay.innerText = `${data.likeCount} l∆∞·ª£t th√≠ch`; // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£t th√≠ch
                    }
                    if (likeButton && likeLabel) {
                        if (data.userLiked) {
                            likeButton.classList.add("bg-blue-500", "text-white"); // ƒê·ªïi m√†u xanh khi ƒë√£ th√≠ch
                            likeButton.classList.remove("hover:bg-gray-700");
                            likeLabel.innerText = "ƒê√£ th√≠ch"; // ƒê·ªïi text th√†nh "ƒê√£ th√≠ch"
                        } else {
                            likeButton.classList.remove("bg-blue-500", "text-white"); // Tr·∫£ v·ªÅ m√†u g·ªëc
                            likeButton.classList.add("hover:bg-gray-700");
                            likeLabel.innerText = "Th√≠ch"; // ƒê·ªïi text th√†nh "Th√≠ch"
                        }
                    }
                })
                .catch(error => console.error("L·ªói khi like b√†i vi·∫øt:", error));
        }
    </script>

    {#SHOW COMMENT#}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function toggleComments(postId) {
                let commentSection = document.getElementById(`comment-section-${postId}`);

                if (commentSection.classList.contains("hidden")) {
                    commentSection.classList.remove("hidden");

                    fetch(`/post/comments/${postId}`)
                        .then(response => response.json())
                        .then(data => {
                            let commentsContainer = document.getElementById(`comments-${postId}`);
                            commentsContainer.innerHTML = ""; // X√≥a b√¨nh lu·∫≠n c≈© tr∆∞·ªõc khi t·∫£i m·ªõi

                            data.comments.forEach(comment => {
                                let date = new Date(comment.createdAt);
                                let formattedDate = date.toLocaleDateString("vi-VN", {
                                    day: "2-digit",
                                    month: "2-digit",
                                    year: "numeric"
                                });

                                const commentElement = document.createElement("div");
                                commentElement.classList.add("flex", "items-start", "space-x-3", "bg-gray-700", "p-3", "rounded-lg");

                                commentElement.innerHTML = `
                        <img src="${comment.authorAvatar}" class="w-10 h-10 rounded-full border border-gray-600">
                        <div class="flex flex-col">
                            <span class="font-semibold text-white">${comment.authorName}</span>
                            <p class="text-gray-300">${comment.content}</p>
                            <div class="flex items-center space-x-4 text-gray-400 text-sm mt-2">
                                <button class="hover:text-blue-400 transition" onclick="likeComment(${comment.id})">
                                    <i class="fas fa-thumbs-up"></i> Th√≠ch
                                </button>
                                <div class="flex items-center">
                                    <i class="fas fa-smile mr-3"></i>
                                    <span id="like-count-${comment.id}" class="ml-1">${comment.likes}</span>
                                    <span class="ml-4 text-sm font-semibold">${formattedDate}</span>
                                </div>
                            </div>
                        </div>
                    `;

                                commentsContainer.appendChild(commentElement);
                            });

                            // Cu·ªôn xu·ªëng b√¨nh lu·∫≠n m·ªõi nh·∫•t
                            setTimeout(() => {
                                commentsContainer.scrollTop = commentsContainer.scrollHeight;
                            }, 100);
                        })
                        .catch(error => console.error("L·ªói khi l·∫•y danh s√°ch b√¨nh lu·∫≠n:", error));
                } else {
                    commentSection.classList.add("hidden");
                }
            }

            window.toggleComments = toggleComments;

            function sendComment(postId) {
                let commentInput = document.getElementById(`comment-input-${postId}`);
                let commentContent = commentInput.value.trim();

                if (!commentContent) return;

                fetch(`/post/comment/${postId}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ content: commentContent }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            commentInput.value = ""; // X√≥a n·ªôi dung trong √¥ nh·∫≠p b√¨nh lu·∫≠n

                            let commentsContainer = document.getElementById(`comments-${postId}`);

                            // Chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng ng√†y (YYYY-MM-DD HH:mm:ss => DD/MM/YYYY)
                            let date = new Date(data.createdAt);
                            let formattedDate = date.toLocaleDateString("vi-VN", {
                                day: "2-digit",
                                month: "2-digit",
                                year: "numeric"
                            });

                            // T·∫°o ph·∫ßn t·ª≠ b√¨nh lu·∫≠n m·ªõi
                            const newComment = document.createElement("div");
                            newComment.classList.add("comment-item");

                            newComment.innerHTML = `
                    <img src="${data.authorAvatar}" class="w-10 h-10 rounded-full border border-gray-700">
                    <div class="comment-content">
                        <div class="comment-header">
                            <span class="font-semibold text-white">${data.authorName}</span>
                        </div>
                        <p class="comment-text text-gray-300">${data.content}</p>
                        <div class="comment-footer flex items-center space-x-4">
                            <button class="text-blue-400 hover:text-blue-500 transition" onclick="likeComment(${data.id})">
                                <i class="fas fa-thumbs-up"></i> Th√≠ch
                            </button>
                            <div class="likes flex items-center text-gray-400">
                                <i class="fas fa-smile"></i>
                                <span id="like-count-${data.id}" class="ml-1">0</span>
                                <span class="ml-4 text-sm font-semibold text-gray-300">${formattedDate}</span>
                            </div>
                        </div>
                    </div>
                `;

                            commentsContainer.appendChild(newComment); // ‚úÖ Th√™m b√¨nh lu·∫≠n m·ªõi v√†o danh s√°ch

                            // Cu·ªôn xu·ªëng b√¨nh lu·∫≠n m·ªõi nh·∫•t
                            setTimeout(() => {
                                commentsContainer.scrollTop = commentsContainer.scrollHeight;
                            }, 100);
                        } else {
                            alert("C√≥ l·ªói x·∫£y ra khi b√¨nh lu·∫≠n!");
                        }
                    })
                    .catch(error => console.error("L·ªói khi g·ª≠i b√¨nh lu·∫≠n:", error));
            }

            window.sendComment = sendComment;

            function likeComment(commentId) {
                fetch(`/post/comment/like/${commentId}`, { method: "POST" })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            let likeCount = document.getElementById(`like-count-${commentId}`);
                            likeCount.innerText = data.likes; // ‚úÖ C·∫≠p nh·∫≠t s·ªë l∆∞·ª£t th√≠ch
                        }
                    })
                    .catch(error => console.error("L·ªói khi like b√¨nh lu·∫≠n:", error));
            }

            window.likeComment = likeComment;
        });
    </script>

    {#SEE MORE#}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            {% for post in posts %}
            (function() {
                const toggleBtn = document.getElementById('toggle-btn-{{ post.id }}');
                const postContent = document.getElementById('post-content-{{ post.id }}');
                let isExpanded = false;

                // ƒê·∫£m b·∫£o r·∫±ng c√°c ph·∫ßn t·ª≠ t·ªìn t·∫°i tr∆∞·ªõc khi thao t√°c
                if (!toggleBtn || !postContent) return;

                // Ki·ªÉm tra chi·ªÅu cao c·ªßa n·ªôi dung v√† ·∫©n n√∫t n·∫øu c·∫ßn thi·∫øt
                if (postContent.scrollHeight <= 500) {
                    toggleBtn.style.display = 'none';  // ·∫®n n√∫t "Xem th√™m" n·∫øu chi·ªÅu cao nh·ªè h∆°n ho·∫∑c b·∫±ng 500px
                } else {
                    toggleBtn.style.display = 'block'; // Hi·ªÉn th·ªã n√∫t "Xem th√™m" n·∫øu chi·ªÅu cao v∆∞·ª£t qu√° 500px
                }

                // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t "Xem th√™m" ho·∫∑c "Thu g·ªçn"
                toggleBtn.addEventListener('click', () => {
                    if (isExpanded) {
                        // N·∫øu ƒëang m·ªü r·ªông, thu g·ªçn l·∫°i
                        postContent.style.maxHeight = '500px';
                        toggleBtn.textContent = 'Xem th√™m';
                    } else {
                        // N·∫øu ƒëang thu g·ªçn, m·ªü r·ªông n·ªôi dung
                        postContent.style.maxHeight = 'none';
                        toggleBtn.textContent = 'Thu g·ªçn';
                    }

                    // ƒê·ªïi tr·∫°ng th√°i m·ªü r·ªông hay thu g·ªçn
                    isExpanded = !isExpanded;
                });
            })();
            {% endfor %}
        });
    </script>

    {# Include Alert Component #}
    {% include 'components/alert.html.twig' %}

{% endblock %}